global
    log stdout local0
    user haproxy
    group haproxy
    daemon

defaults
    mode http
    log global
    option httplog
    option dontlognull
    option log-health-checks
    option forwardfor except 127.0.0.0/8
    option redispatch
    retries 3
    timeout http-request 10s
    timeout queue 1m
    timeout connect 10s
    timeout client 1m
    timeout server 1m
    timeout http-keep-alive 10s
    timeout check 10s
    maxconn 3000

# Stats page
frontend stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 30s
    stats admin if LOCALHOST

# Production Frontend
frontend prod_frontend
    bind *:80
    mode http
    default_backend prod_web_servers

# Production Backend - using external services
backend prod_web_servers
    balance roundrobin
    mode http
    option httpchk GET /
    server prod-web1 httpbin.org:80 weight 100 check
    server prod-web2 jsonplaceholder.typicode.com:80 weight 80 check inter 5s fall 3 rise 2
    server prod-web3 httpbin.org:80 weight 60 check inter 5s fall 3 rise 2

backend prod_api_servers
    balance leastconn
    mode http
    option httpchk GET /get
    server prod-api1 httpbin.org:80 weight 100 check
    server prod-api2 jsonplaceholder.typicode.com:80 weight 80 check inter 3s fall 2 rise 3 
